{"ast":null,"code":"import _regeneratorRuntime from \"/Users/andrew/Documents/Work/SIBM-Test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/andrew/Documents/Work/SIBM-Test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"/Users/andrew/Documents/Work/SIBM-Test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback, useReducer, useState } from 'react';\nimport { NetworkContext } from './context';\nimport { defaultNetworkState, networksReducer } from './reducer';\nimport { JsonRpcProvider, Web3Provider } from '@ethersproject/providers';\nimport { subscribeToProviderEvents } from '../../helpers/eip1193';\n\nfunction tryToGetAccount(_x) {\n  return _tryToGetAccount.apply(this, arguments);\n}\n\nfunction _tryToGetAccount() {\n  _tryToGetAccount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(provider) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return provider.getSigner().getAddress();\n\n          case 3:\n            return _context2.abrupt(\"return\", _context2.sent);\n\n          case 6:\n            _context2.prev = 6;\n            _context2.t0 = _context2[\"catch\"](0);\n\n            if (!(_context2.t0.code === 'UNSUPPORTED_OPERATION')) {\n              _context2.next = 10;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", undefined);\n\n          case 10:\n            throw _context2.t0;\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[0, 6]]);\n  }));\n  return _tryToGetAccount.apply(this, arguments);\n}\n\nexport function NetworkProvider(_ref) {\n  var children = _ref.children;\n\n  var _useReducer = useReducer(networksReducer, defaultNetworkState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      network = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var _useState = useState(function () {\n    return function () {\n      return undefined;\n    };\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      onUnsubscribe = _useState2[0],\n      setOnUnsubscribe = _useState2[1];\n\n  var update = useCallback(function (newNetwork) {\n    dispatch({\n      type: 'UPDATE_NETWORK',\n      network: newNetwork\n    });\n  }, [network]);\n  var reportError = useCallback(function (error) {\n    console.error(error);\n    dispatch({\n      type: 'ADD_ERROR',\n      error: error\n    });\n  }, []);\n  var deactivate = useCallback(function () {\n    update({\n      accounts: []\n    });\n  }, []);\n  var onDisconnect = useCallback(function (error) {\n    deactivate();\n    reportError(error);\n  }, []);\n  var activate = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(provider) {\n      var _a, wrappedProvider, account, chainId, clearSubscriptions;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              wrappedProvider = provider instanceof JsonRpcProvider ? provider : new Web3Provider(provider);\n              _context.prev = 1;\n              _context.next = 4;\n              return tryToGetAccount(wrappedProvider);\n\n            case 4:\n              account = _context.sent;\n              _context.next = 7;\n              return wrappedProvider.getNetwork();\n\n            case 7:\n              _context.t1 = _a = _context.sent;\n              _context.t0 = _context.t1 === null;\n\n              if (_context.t0) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.t0 = _a === void 0;\n\n            case 11:\n              if (!_context.t0) {\n                _context.next = 15;\n                break;\n              }\n\n              _context.t2 = void 0;\n              _context.next = 16;\n              break;\n\n            case 15:\n              _context.t2 = _a.chainId;\n\n            case 16:\n              chainId = _context.t2;\n              onUnsubscribe();\n              clearSubscriptions = subscribeToProviderEvents(wrappedProvider.provider, update, onDisconnect);\n              setOnUnsubscribe(function () {\n                return clearSubscriptions;\n              });\n              update({\n                provider: wrappedProvider,\n                chainId: chainId,\n                accounts: account ? [account] : []\n              });\n              _context.next = 26;\n              break;\n\n            case 23:\n              _context.prev = 23;\n              _context.t3 = _context[\"catch\"](1);\n              reportError(_context.t3);\n\n            case 26:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 23]]);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [onUnsubscribe]);\n  return _jsx(NetworkContext.Provider, {\n    value: {\n      network: network,\n      update: update,\n      activate: activate,\n      deactivate: deactivate,\n      reportError: reportError\n    },\n    children: children\n  }, void 0);\n}","map":null,"metadata":{},"sourceType":"module"}